version: '3'
services:
  rclone:
    image: rclone/rclone
    container_name: rclone-desktop
    security_opt:
      - apparmor:unconfined
    cap_add:
      - SYS_ADMIN
    devices:
      - /dev/fuse
    volumes:
      - ~/rccheck:/backup:shared
      - ~/env/personal/:/config/rclone/:ro
      - rclone-cache:/cache
    environment:
      - PUID=1000
      - PGID=1000
    command: >
      mount hetzner-storagebox:/backup /backup
      --vfs-cache-mode full
      --vfs-cache-max-size 100G
      --vfs-cache-max-age 24h
      --buffer-size 256M
      --vfs-read-ahead 512M
      --vfs-read-chunk-size 32M
      --vfs-read-chunk-size-limit 1G
      --dir-cache-time 24h
      --poll-interval 15s
      --attr-timeout 1s
      --vfs-cache-poll-interval 15s
      --daemon
      --allow-other
      --uid 1000
      --gid 1000
      --umask 022
    restart: unless-stopped

volumes:
  rclone-cache:
    driver: local
